---
layout: post
title: 스토리지 Storage 저장소
author: 주인장
tags:
- storage
- 스토리지
- GCP
---

# 스토리지에 관한 짧은 설명

## 스토리지 서비스는 크게 세가지로 나뉜다

Block, File, Object 이렇게 3가지로 나누어 구분합니다.
각 스토리지를 하나의 서버 혹은 서비스라고 바라보고, 내가 그 서비스를 받는 쪽이라고 생각하면, 구분이 매우 쉬워 집니다.
물론 세상에는 이 세 가지로 가두어 설명할 수 없는 스토리지 서비스가 있습니다. 대체로 이 범주에 들어간다는 의미입니다.

| 접근 방식 | 접근 경로 | 스토리지 종류 |
| -- | -- | -- |
| Block level access | /dev/dsk/c0t0d0s0 <br /> /dev/md0 <br /> /dev/sda1 | Block |
| File level access  |server:/path | File |
| Object level access | https://fqdn/uri.object | Object |

### Block Storage

Block storage은 그 단어 의미 그래도 block device를 이루는 스토리지입니다.
파일시스템을 직접 작성할 수 있고, VM과 같은 연산장치에 종속되게 됩니다.
여러분의 랩탑의 ‘하드 드라이브'가 바로 block 스토리지입니다. 
GCP에서는 persistent disk로 불리우며,
VM의 OS가 설치되는 기본 boot disk 또한 block 스토리지입니다. 

### File Storage

File storage는 파일 수준의 데이터의 적재와 조작에 관여합니다.
NAS가 대표적인 file 스토리지이며 대표적인 프로토콜로서는 
[CIFS/SMB](https://learn.microsoft.com/en-us/windows/win32/fileio/microsoft-smb-protocol-and-cifs-protocol-overview) 와 
[NFS](https://en.wikipedia.org/wiki/Network_File_System)가 있습니다. 
우리 GCP에서는 Filestore가 file 스토리지의 대표 상품이며, 
우리의 파트너이자 세상 모든 클라우드 업체들에게 서비스를 제공하려는, 
NetApp의 대표 솔루션도 file 스토리지입니다.

### Object Storage

Google Cloud에서는 GCS, Google Cloud Storage가 이에 해당합니다.
Object storage의 대표적인 특징은 API에 의한 파일(정확하게는 object)을 호출하고 사용하고 저장하고 - 
아무튼 모든 작업을 그렇게 한다는 것입니다. 
이 API는 대체로 REST API 형식을 따르는 것이 국룰이며 현재까지 잘 지켜지고 있습니다. 

Object storage는 앞서 설명한 두 가지 스토리지와 다르게 운영체제에서 마운트해서 사용하는
지역적인 혹은 단일 네트워크 범위 내에 제약되는 스토리지는 아닙니다.
설정에 따라 전세계 네트워크로 접근 가능한 모든 곳에서 서비스를 받을 수 있고
운영체제가 있는 기계(혹은 그와 같은 자격의 무엇)의 지원없이 독자적으로 
클라아언트들(clients)에 서비스를 제공할 수 있습니다.

다른 스토리지 서비스와 무언가 결이 다른 이유는,
object storage의 본질은 '데몬이 웹 서비스를 하고 있는 서버'이기 때문입니다.

## 그림으로 설명

조금 태키 혹은 너드의 향기가 풍기지면, 
아래의 그림과 같이 우리가 구분하는 스토리지의 역할을 분별해 낼 수 있습니다. 
(예술적 감성은 부족하지만, 나름 최선을 다해 그려 보았습니다)

![storage services in a system](/media/2023/storage-layers2.png){:width="80%"}

그림 아래에서부터 위로 오르며 설명을 하겠습니다.

### 디스크 disk

물성이 있는 디스크가 있습니다. 스핀들 디스크(spindle disk) 혹은 자기 디스크(magnetic disk)라고도
불리우는 이 디스크는 여러분께서 손에 쥘 수 있는 물건입니다. 혹은 이제는 널리 사용되고 있는 SSD(NVMe)도
엄밀하게 따지고 들어가면 디스크의 한 종류라고 할 수 있습니다.

이 디스크가 기본적으로 block device(block storage)입니다.

### block storage

Oracle Database의 경우처럼 이 block device(이 때에는 raw disk, 혹은 raw device라고 부리기도 합니다)를
직접 접근(access)하여 운영체제의 간섭을 최소화하고 스스로 모든 것을 책임지는 서비스를 구성하기도 합니다.
하지만, 대부분의 경우는 파일 시스템(filesystem)을 작성하여 운영체제에서 마운트해서 사용하게 됩니다.
이 과정은 end-user에게 설명할 때 '포멧한다'라고 말하는 것이 가장 쉽게 전달하는 방식이 됩니다. 

파일 시스템이 작성되면 block storage로서의 필요한 모습은 모두 갖추었습니다.

### file storage

작성된 파일 시스템을 기반으로 특정 TCP/UDP 서비스를 동작시키는 데몬(daemon)을 띄워
원격의 클라이언트들(clients)이 약속된 프로토콜(protocol)로 데몬이 동작하는 
서버의 파일 시스템에 접근하여 그 공간을 사용할 수 있게 하는 것이 
file storage의 가장 간략한 설명일 수 있겠습니다.

엔터프라이즈 환경에서는 
NFS(network file system)이 대표적이고 1984년 Sun Microsystems에 의하여
설계되었고, 널리 사용되어 업계 표준이 되었습니다. Sun Microsystems는 
the Network is the Computer라는 사명으로 많은 유산을 우리 일상에 배풀고 사라졌습니다.

사무를 위한 로칼 네트워크에서는 CIFS/SMB가 주로 쓰일 것입니다.
윈도의 '공유'도 여기에 해당되며 응용과 활용의 범위가 상당히 넓습니다. 

어떤 서비스를 설계할 때 복잡한 파일의 교환 문제도 
file storage를 채택하고 인증체계만 정리하면 간단히 해결할 수 있습니다.

### object storage

디스크가 주렁주렁 달려있는 서버가 있고
그 서버가 HTTPD(웹 데몬)를 동작시키고 서로 약속되 REST API를 지원해 주면
object storage가 됩니다. 기본적으로 웹 서비스입니다.

물론, 현대적인 대규모 object storage 설계는 무척 복잡합니디만, 간략히 하면 위와 같습니다.

그래서 object에 접근하는 경로가 웹 주소과 같습니다. https://address.url/path/to/object.file
그래서 POST/GET과 같은 정의가 따릅니다. 그래서 서비스 설게에 제약이 상당히 낮습니다.
그래서 클라우드 네이티브한 환경에서 상당히 어울립니다.
